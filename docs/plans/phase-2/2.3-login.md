# Phase 2.3: User Login

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create user login endpoint with credential validation and ban check.

**Architecture:** LoginRequest → AuthController → Token generation.

**Tech Stack:** Laravel Sanctum

**Prerequisites:** Phase 2.2 complete

**Reference:** `docs/specifications/05-api-endpoints.md`, `docs/plans/phase-2-auth-and-users.md` Task 3

---

## Implementation

Follow **Task 3** from `docs/plans/phase-2-auth-and-users.md`:

1. **Write login tests** - `tests/Feature/Auth/LoginTest.php`
   - Test valid credentials
   - Test invalid credentials (INVALID_CREDENTIALS)
   - Test banned user (ACCOUNT_BANNED)

2. **Create LoginRequest** - `app/Http/Requests/Auth/LoginRequest.php`
   - email: required, email
   - password: required, string

3. **Add login method to AuthController**
   - Validate credentials with `auth()->attempt()`
   - Check `is_banned` flag
   - Return Sanctum tokens

4. **Add route**: `Route::post('login', [AuthController::class, 'login']);`

5. **Run tests and commit**

---

## Key Code

```php
// AuthController::login
public function login(LoginRequest $request): JsonResponse
{
    if (!auth()->attempt($request->only('email', 'password'))) {
        throw new ApiException('INVALID_CREDENTIALS', 'Invalid email or password.', 401);
    }

    $user = auth()->user();

    if ($user->is_banned) {
        auth()->logout();
        throw new ApiException('ACCOUNT_BANNED', 'Your account has been banned.', 403);
    }

    // Create tokens and return AuthResource
}
```

---

## Phase 2.3 Completion Checklist

- [ ] LoginRequest created
- [ ] login() method added to AuthController
- [ ] Invalid credentials return 401 INVALID_CREDENTIALS
- [ ] Banned users return 403 ACCOUNT_BANNED
- [ ] Route added
- [ ] Tests passing
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 2.4: Token Management** for refresh and logout.
