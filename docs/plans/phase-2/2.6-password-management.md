# Phase 2.6: Password Management

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create password change endpoint with current password verification.

**Architecture:** Verify current password before allowing change.

**Tech Stack:** Laravel Hash facade

**Prerequisites:** Phase 2.5 complete

**Reference:** `docs/specifications/05-api-endpoints.md`, `docs/plans/phase-2-auth-and-users.md` Task 6

---

## Implementation

Follow **Task 6** from `docs/plans/phase-2-auth-and-users.md`:

1. **Write password tests** - `tests/Feature/User/PasswordTest.php`
   - Test successful password change
   - Test wrong current password (INVALID_PASSWORD)

2. **Create ChangePasswordRequest** - `app/Http/Requests/User/ChangePasswordRequest.php`
   - current_password: required, string
   - password: required, string, min:8, confirmed

3. **Add changePassword to UserController**
   - Verify current password with Hash::check()
   - Update password

4. **Add route**:
   ```php
   Route::put('me/password', [UserController::class, 'changePassword']);
   ```

5. **Run tests and commit**

---

## Key Code

```php
// UserController::changePassword
public function changePassword(ChangePasswordRequest $request): JsonResponse
{
    $user = auth()->user();

    if (!Hash::check($request->current_password, $user->password)) {
        throw new ApiException('INVALID_PASSWORD', 'Current password is incorrect.', 400);
    }

    $user->update(['password' => $request->password]);

    return response()->json([
        'data' => ['message' => 'Password updated successfully.'],
    ]);
}
```

---

## Phase 2.6 Completion Checklist

- [ ] ChangePasswordRequest created
- [ ] changePassword() verifies current password
- [ ] Wrong password returns 400 INVALID_PASSWORD
- [ ] Route added
- [ ] Tests passing
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 2.7: Friendships** for friendship system.
