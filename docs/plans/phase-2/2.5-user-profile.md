# Phase 2.5: User Profile

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create user profile get and update endpoints.

**Architecture:** UserController handles /me endpoints, updates both User and UserPreference.

**Tech Stack:** Laravel Form Requests, API Resources

**Prerequisites:** Phase 2.4 complete

**Reference:** `docs/specifications/05-api-endpoints.md`, `docs/plans/phase-2-auth-and-users.md` Task 5

---

## Implementation

Follow **Task 5** from `docs/plans/phase-2-auth-and-users.md`:

1. **Write profile tests** - `tests/Feature/User/ProfileTest.php`
   - Test get profile
   - Test update display_name and locale
   - Test update notification preferences

2. **Create UpdateProfileRequest** - `app/Http/Requests/User/UpdateProfileRequest.php`
   - display_name: nullable, string, max:100
   - locale: nullable, string, in:en,fr
   - notif_email: nullable, boolean
   - notif_push: nullable, boolean

3. **Create UserController** - `app/Http/Controllers/Api/V1/UserController.php`
   - show(): Get authenticated user with preference
   - update(): Update user fields and preference fields

4. **Add routes** (inside auth:sanctum):
   ```php
   Route::get('me', [UserController::class, 'show']);
   Route::put('me', [UserController::class, 'update']);
   ```

5. **Run tests and commit**

---

## Key Code

```php
// UserController
public function show(): JsonResponse
{
    $user = auth()->user()->load('preference');
    return response()->json(['data' => new UserResource($user)]);
}

public function update(UpdateProfileRequest $request): JsonResponse
{
    $user = auth()->user();

    // Update user fields
    $user->update($request->only(['display_name']));

    // Update preference fields
    $preferenceData = $request->only(['locale', 'notif_email', 'notif_push']);
    if (!empty($preferenceData)) {
        $user->preference()->updateOrCreate(
            ['user_id' => $user->id],
            $preferenceData
        );
    }

    return response()->json([
        'data' => new UserResource($user->fresh()->load('preference')),
    ]);
}
```

---

## Phase 2.5 Completion Checklist

- [ ] UpdateProfileRequest created
- [ ] UserController::show() returns user with preference
- [ ] UserController::update() updates user and preference
- [ ] Routes added
- [ ] Tests passing
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 2.6: Password Management** for password change.
