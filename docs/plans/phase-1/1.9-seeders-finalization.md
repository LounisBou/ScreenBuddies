# Phase 1.9: Seeders & Finalization

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create MediaType seeder and finalize Phase 1 with full verification.

**Architecture:** Seeder populates media types (movie, tvshow, videogame, boardgame, theater).

**Tech Stack:** Laravel 11, Database Seeders

**Prerequisites:**
- Phase 1.8 complete (User relationships)

**Reference:** `docs/specifications/02-data-model.md`

---

## Task 1: Create MediaType Seeder

**Files:**
- Create: `backend/database/seeders/MediaTypeSeeder.php`

**Step 1: Generate seeder**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan make:seeder MediaTypeSeeder
```

**Step 2: Edit the seeder**

Replace contents of `backend/database/seeders/MediaTypeSeeder.php`:
```php
<?php

namespace Database\Seeders;

use App\Models\MediaType;
use Illuminate\Database\Seeder;

class MediaTypeSeeder extends Seeder
{
    public function run(): void
    {
        $types = [
            [
                'code' => 'movie',
                'label' => 'media_type.movie',
                'api_source' => 'tmdb',
                'is_active' => true,
            ],
            [
                'code' => 'tvshow',
                'label' => 'media_type.tvshow',
                'api_source' => 'tmdb',
                'is_active' => true,
            ],
            [
                'code' => 'videogame',
                'label' => 'media_type.videogame',
                'api_source' => 'rawg',
                'is_active' => true,
            ],
            // Placeholders - set is_active = false until implementation complete
            // See docs/future-ideas.md for details
            [
                'code' => 'boardgame',
                'label' => 'media_type.boardgame',
                'api_source' => 'bgg',
                'is_active' => false,  // Placeholder
            ],
            [
                'code' => 'theater',
                'label' => 'media_type.theater',
                'api_source' => 'custom',
                'is_active' => false,  // Placeholder
            ],
        ];

        foreach ($types as $type) {
            MediaType::updateOrCreate(
                ['code' => $type['code']],
                $type
            );
        }
    }
}
```

---

## Task 2: Register Seeder in DatabaseSeeder

**Files:**
- Modify: `backend/database/seeders/DatabaseSeeder.php`

**Step 1: Read current DatabaseSeeder**

Read `backend/database/seeders/DatabaseSeeder.php`.

**Step 2: Register MediaTypeSeeder**

Replace contents of `backend/database/seeders/DatabaseSeeder.php`:
```php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            MediaTypeSeeder::class,
        ]);
    }
}
```

---

## Task 3: Run Seeder

**Files:** None

**Step 1: Run database seeder**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan db:seed
```

Expected: Seeder completes successfully

**Step 2: Verify media types created**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan tinker --execute="App\Models\MediaType::count()"
```

Expected: `5`

**Step 3: Verify active media types**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan tinker --execute="App\Models\MediaType::where('is_active', true)->pluck('code')"
```

Expected: `["movie", "tvshow", "videogame"]`

---

## Task 4: Run Fresh Migration with Seed

**Files:** None

**Step 1: Fresh migration with seeding**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan migrate:fresh --seed
```

Expected: All migrations run and seeder completes

---

## Task 5: Verify Database Structure

**Files:** None

**Step 1: List all tables**

Run:
```bash
psql screenbuddies -c '\dt'
```

Expected: Tables listed:
- users
- password_reset_tokens
- sessions
- personal_access_tokens
- user_preferences
- media_types
- friendships
- elections
- candidates
- voters

**Step 2: Verify users table columns**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan tinker --execute="Schema::getColumnListing('users')"
```

Expected: All columns listed (id, email, password, display_name, avatar_url, etc.)

**Step 3: Verify elections table columns**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan tinker --execute="Schema::getColumnListing('elections')"
```

Expected: All columns listed (id, uuid, invite_token, title, etc.)

---

## Task 6: Run Full Test Suite

**Files:** None

**Step 1: Run all tests**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan test
```

Expected: All tests PASS

**Step 2: Run static analysis**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && composer analyse
```

Expected: No errors (or acceptable warnings)

**Step 3: Run code style check**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && composer format:check
```

Expected: No style violations (run `composer format` if needed)

---

## Task 7: Commit Seeders

**Files:**
- `backend/database/seeders/MediaTypeSeeder.php`
- `backend/database/seeders/DatabaseSeeder.php`

**Step 1: Stage and commit**

Run:
```bash
git add backend/ && git commit -m "feat: add MediaType seeder with 5 types"
```

---

## Task 8: Final Phase 1 Commit

**Files:** None

**Step 1: Verify all changes committed**

Run:
```bash
git status
```

Expected: Working tree clean (or only untracked files)

**Step 2: Create final Phase 1 commit (if any remaining changes)**

Run:
```bash
git add . && git commit -m "chore: phase 1 complete - backend foundation"
```

---

## Phase 1.9 Completion Checklist

- [ ] MediaTypeSeeder created with 5 media types
- [ ] DatabaseSeeder updated to call MediaTypeSeeder
- [ ] Seeder runs successfully
- [ ] 3 active media types (movie, tvshow, videogame)
- [ ] 2 placeholder media types (boardgame, theater)
- [ ] Fresh migration with seed works
- [ ] All database tables created
- [ ] All tests passing
- [ ] Static analysis clean
- [ ] Code style clean
- [ ] Git commits created

---

## Phase 1 Complete

All backend foundation components are now in place:

| Component | Status |
|-----------|--------|
| Laravel Sanctum | Configured |
| User Model | Created |
| UserPreference Model | Created |
| MediaType Model | Created |
| Friendship Model | Created |
| Election Model | Created |
| Candidate Model | Created |
| Voter Model | Created |
| ElectionStatus Enum | Created |
| FriendshipStatus Enum | Created |
| MediaType Seeder | Created |
| All Relationships | Configured |
| Unit Tests | Passing |

---

## Next Phase

Proceed to **Phase 2: Auth and Users** for authentication endpoints and user management.
