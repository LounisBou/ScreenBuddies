# Phase 1.1: Sanctum & Pest Setup

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Install Laravel Sanctum for API authentication and Pest for testing.

**Architecture:** Sanctum with short-lived access tokens (15 min) and long-lived refresh tokens (7 days).

**Tech Stack:** Laravel Sanctum, Pest

**Prerequisites:**
- Phase 0 complete (Laravel project initialized)

**Reference:** `docs/specifications/03-backend-architecture.md`

---

## Task 1: Install Laravel Sanctum

**Files:**
- Modify: `backend/composer.json`

**Step 1: Navigate to backend directory**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend
```

**Step 2: Install Sanctum package**

Run:
```bash
composer require laravel/sanctum
```

Expected: Package installed successfully

**Step 3: Verify installation**

Run:
```bash
composer show laravel/sanctum
```

Expected: Package version displayed

---

## Task 2: Publish Sanctum Configuration

**Files:**
- Create: `backend/config/sanctum.php`
- Create: `backend/database/migrations/xxxx_create_personal_access_tokens_table.php`

**Step 1: Publish Sanctum config and migration**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"
```

Expected: Config and migration published

**Step 2: Verify config file exists**

Run:
```bash
ls -la /Users/lounis/dev/ScreenBuddies/backend/config/sanctum.php
```

Expected: File exists

---

## Task 3: Configure Token Expiration

**Files:**
- Modify: `backend/config/sanctum.php`

**Step 1: Read current sanctum config**

Read `backend/config/sanctum.php` to see default configuration.

**Step 2: Update token expiration settings**

Find the `expiration` key in `backend/config/sanctum.php` and update:
```php
'expiration' => 15, // Access token expires in 15 minutes
```

**Step 3: Add custom refresh token expiration**

Add after the `expiration` key:
```php
// Custom: Refresh token expiration (7 days in minutes)
'refresh_expiration' => 10080,
```

---

## Task 4: Run Sanctum Migration

**Files:** None

**Step 1: Run migrations**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan migrate
```

Expected: personal_access_tokens table created

**Step 2: Verify table exists**

Run:
```bash
psql screenbuddies -c '\dt' | grep personal_access_tokens
```

Expected: personal_access_tokens table listed

---

## Task 5: Commit Sanctum Setup

**Files:**
- `backend/composer.json`
- `backend/composer.lock`
- `backend/config/sanctum.php`
- `backend/database/migrations/*personal_access_tokens*`

**Step 1: Check git status**

Run:
```bash
git status
```

**Step 2: Stage Sanctum files**

Run:
```bash
git add backend/
```

**Step 3: Create commit**

Run:
```bash
git commit -m "$(cat <<'EOF'
chore: install and configure Laravel Sanctum

- Sanctum package installed
- Access token expiration: 15 minutes
- Refresh token expiration: 7 days
- personal_access_tokens migration run
EOF
)"
```

---

## Task 6: Verify Pest Installation

**Note:** Pest was installed in Phase 0.2. This task verifies it's working.

**Files:** None

**Step 1: Check Pest is installed**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && vendor/bin/pest --version
```

Expected: Pest version displayed

**Step 2: Run existing tests**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan test
```

Expected: All tests pass

---

## Task 7: Create Unit Tests Directory Structure

**Files:**
- Create: `backend/tests/Unit/Models/` directory

**Step 1: Create Models test directory**

Run:
```bash
mkdir -p /Users/lounis/dev/ScreenBuddies/backend/tests/Unit/Models
```

**Step 2: Verify directory exists**

Run:
```bash
ls -la /Users/lounis/dev/ScreenBuddies/backend/tests/Unit/
```

Expected: `Models` directory listed

---

## Phase 1.1 Completion Checklist

- [ ] Laravel Sanctum installed
- [ ] sanctum.php config published
- [ ] Access token expiration: 15 minutes
- [ ] Refresh token expiration: 7 days
- [ ] personal_access_tokens migration run
- [ ] Pest working correctly
- [ ] Unit tests directory structure created
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 1.2: User Models** for User and UserPreference models.
