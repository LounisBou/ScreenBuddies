# Phase 1.3: MediaType Model

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create MediaType model for election media categorization.

**Architecture:** Lookup table for media types (movie, tvshow, videogame, etc.) with API source mapping.

**Tech Stack:** Laravel 11, Eloquent, Pest

**Prerequisites:**
- Phase 1.2 complete (User models)

**Reference:** `docs/specifications/02-data-model.md`

---

## Task 1: Write MediaType Model Test (TDD)

**Files:**
- Create: `backend/tests/Unit/Models/MediaTypeTest.php`

**Step 1: Create MediaType test**

Create `backend/tests/Unit/Models/MediaTypeTest.php`:
```php
<?php

use App\Models\MediaType;

test('media type has required fillable attributes', function () {
    $mediaType = new MediaType();

    expect($mediaType->getFillable())->toContain('code')
        ->toContain('label')
        ->toContain('api_source');
});

test('media type casts is_active to boolean', function () {
    $mediaType = new MediaType();

    expect($mediaType->getCasts())->toHaveKey('is_active');
});

test('media type has elections relationship', function () {
    $mediaType = new MediaType();

    expect(method_exists($mediaType, 'elections'))->toBeTrue();
});
```

**Step 2: Run test to verify it fails**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan test tests/Unit/Models/MediaTypeTest.php
```

Expected: FAIL (model doesn't exist)

---

## Task 2: Create MediaType Migration

**Files:**
- Create: `backend/database/migrations/xxxx_create_media_types_table.php`

**Step 1: Generate migration**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan make:migration create_media_types_table
```

**Step 2: Edit the migration**

Find the newly created migration file and replace contents:
```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('media_types', function (Blueprint $table) {
            $table->id();
            $table->string('code', 50)->unique();
            $table->string('label', 100);
            $table->enum('api_source', ['tmdb', 'rawg', 'bgg', 'custom']);
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('media_types');
    }
};
```

---

## Task 3: Create MediaType Model

**Files:**
- Create: `backend/app/Models/MediaType.php`

**Step 1: Create MediaType model**

Create `backend/app/Models/MediaType.php`:
```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;

class MediaType extends Model
{
    use HasFactory;

    protected $fillable = [
        'code',
        'label',
        'api_source',
        'is_active',
    ];

    protected function casts(): array
    {
        return [
            'is_active' => 'boolean',
        ];
    }

    public function elections(): HasMany
    {
        return $this->hasMany(Election::class);
    }
}
```

---

## Task 4: Run Migration and Tests

**Files:** None

**Step 1: Run migration**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan migrate
```

Expected: media_types table created

**Step 2: Run MediaType tests**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan test tests/Unit/Models/MediaTypeTest.php
```

Expected: All tests PASS

---

## Task 5: Commit MediaType Model

**Files:**
- `backend/database/migrations/*media_types*`
- `backend/app/Models/MediaType.php`
- `backend/tests/Unit/Models/MediaTypeTest.php`

**Step 1: Stage and commit**

Run:
```bash
git add backend/ && git commit -m "feat: add MediaType model"
```

---

## Phase 1.3 Completion Checklist

- [ ] MediaType model test written (TDD)
- [ ] MediaType migration created
- [ ] MediaType model created with elections relationship
- [ ] is_active boolean cast
- [ ] api_source enum (tmdb, rawg, bgg, custom)
- [ ] Tests passing
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 1.4: Friendship Model** for social relationships.
