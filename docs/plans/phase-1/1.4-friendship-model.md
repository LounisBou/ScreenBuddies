# Phase 1.4: Friendship Model

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Create Friendship model for user social relationships with status enum.

**Architecture:** Requester-Addressee pattern with status enum (pending, accepted, declined).

**Tech Stack:** Laravel 11, PHP Enums, Eloquent, Pest

**Prerequisites:**
- Phase 1.3 complete (MediaType model)

**Reference:** `docs/specifications/02-data-model.md`

---

## Task 1: Create FriendshipStatus Enum

**Files:**
- Create: `backend/app/Enums/FriendshipStatus.php`

**Step 1: Create Enums directory**

Run:
```bash
mkdir -p /Users/lounis/dev/ScreenBuddies/backend/app/Enums
```

**Step 2: Create FriendshipStatus enum**

Create `backend/app/Enums/FriendshipStatus.php`:
```php
<?php

namespace App\Enums;

enum FriendshipStatus: string
{
    case PENDING = 'pending';
    case ACCEPTED = 'accepted';
    case DECLINED = 'declined';
}
```

---

## Task 2: Write Friendship Model Test (TDD)

**Files:**
- Create: `backend/tests/Unit/Models/FriendshipTest.php`

**Step 1: Create Friendship test**

Create `backend/tests/Unit/Models/FriendshipTest.php`:
```php
<?php

use App\Models\Friendship;
use App\Enums\FriendshipStatus;

test('friendship belongs to requester and addressee', function () {
    $friendship = new Friendship();

    expect(method_exists($friendship, 'requester'))->toBeTrue();
    expect(method_exists($friendship, 'addressee'))->toBeTrue();
});

test('friendship status is cast to enum', function () {
    $friendship = new Friendship();

    expect($friendship->getCasts())->toHaveKey('status');
});

test('friendship status enum has correct values', function () {
    expect(FriendshipStatus::PENDING->value)->toBe('pending');
    expect(FriendshipStatus::ACCEPTED->value)->toBe('accepted');
    expect(FriendshipStatus::DECLINED->value)->toBe('declined');
});
```

**Step 2: Run test to verify it fails**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan test tests/Unit/Models/FriendshipTest.php
```

Expected: FAIL (model doesn't exist)

---

## Task 3: Create Friendship Migration

**Files:**
- Create: `backend/database/migrations/xxxx_create_friendships_table.php`

**Step 1: Generate migration**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan make:migration create_friendships_table
```

**Step 2: Edit the migration**

Replace contents:
```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('friendships', function (Blueprint $table) {
            $table->id();
            $table->foreignId('requester_id')->constrained('users')->onDelete('cascade');
            $table->foreignId('addressee_id')->constrained('users')->onDelete('cascade');
            $table->string('status')->default('pending');
            $table->timestamps();

            $table->unique(['requester_id', 'addressee_id']);
            $table->index(['requester_id', 'addressee_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('friendships');
    }
};
```

---

## Task 4: Create Friendship Model

**Files:**
- Create: `backend/app/Models/Friendship.php`

**Step 1: Create Friendship model**

Create `backend/app/Models/Friendship.php`:
```php
<?php

namespace App\Models;

use App\Enums\FriendshipStatus;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class Friendship extends Model
{
    use HasFactory;

    protected $fillable = [
        'requester_id',
        'addressee_id',
        'status',
    ];

    protected function casts(): array
    {
        return [
            'status' => FriendshipStatus::class,
        ];
    }

    public function requester(): BelongsTo
    {
        return $this->belongsTo(User::class, 'requester_id');
    }

    public function addressee(): BelongsTo
    {
        return $this->belongsTo(User::class, 'addressee_id');
    }
}
```

---

## Task 5: Run Migration and Tests

**Files:** None

**Step 1: Run migration**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan migrate
```

**Step 2: Run Friendship tests**

Run:
```bash
cd /Users/lounis/dev/ScreenBuddies/backend && php artisan test tests/Unit/Models/FriendshipTest.php
```

Expected: All tests PASS

---

## Task 6: Commit Friendship Model

**Files:**
- `backend/app/Enums/FriendshipStatus.php`
- `backend/database/migrations/*friendships*`
- `backend/app/Models/Friendship.php`
- `backend/tests/Unit/Models/FriendshipTest.php`

**Step 1: Stage and commit**

Run:
```bash
git add backend/ && git commit -m "feat: add Friendship model with status enum"
```

---

## Phase 1.4 Completion Checklist

- [ ] FriendshipStatus enum created (pending, accepted, declined)
- [ ] Friendship model test written (TDD)
- [ ] Friendship migration with unique constraint
- [ ] Friendship model with requester/addressee relationships
- [ ] Status cast to enum
- [ ] Tests passing
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 1.5: Election Model** for the core election entity.
