# Phase 0.2: Development Tools Setup

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Install and configure PHPStan, PHP CS Fixer, and Pest for code quality and testing.

**Architecture:** Static analysis + code formatting + testing framework integrated via Composer scripts.

**Tech Stack:** PHPStan 1.x with Larastan, PHP CS Fixer 3.x, Pest 2.x

**Prerequisites:**
- Phase 0.1 completed (Laravel project initialized)

**Reference:** `docs/specifications/03-backend-architecture.md`

---

## Task 1: Install PHPStan with Larastan

**Files:**
- Modify: `backend/composer.json`

**Step 1: Install PHPStan and Larastan**

Run:
```bash
cd backend && composer require --dev phpstan/phpstan larastan/larastan
```

Expected: Packages installed successfully

**Step 2: Verify installation**

Run:
```bash
cd backend && vendor/bin/phpstan --version
```

Expected: `PHPStan - PHP Static Analysis Tool 1.x.x`

---

## Task 2: Create PHPStan Configuration

**Files:**
- Create: `backend/phpstan.neon`

**Step 1: Create phpstan.neon file**

Create `backend/phpstan.neon`:
```neon
includes:
    - vendor/larastan/larastan/extension.neon

parameters:
    paths:
        - app/
    level: 5
    ignoreErrors:
    excludePaths:
```

**Step 2: Run PHPStan to verify config**

Run:
```bash
cd backend && vendor/bin/phpstan analyse
```

Expected: "No errors" or analysis completes without config errors

---

## Task 3: Install PHP CS Fixer

**Files:**
- Modify: `backend/composer.json`

**Step 1: Install PHP CS Fixer**

Run:
```bash
cd backend && composer require --dev friendsofphp/php-cs-fixer
```

Expected: Package installed successfully

**Step 2: Verify installation**

Run:
```bash
cd backend && vendor/bin/php-cs-fixer --version
```

Expected: `PHP CS Fixer 3.x.x`

---

## Task 4: Create PHP CS Fixer Configuration

**Files:**
- Create: `backend/.php-cs-fixer.php`

**Step 1: Create .php-cs-fixer.php file**

Create `backend/.php-cs-fixer.php`:
```php
<?php

$finder = PhpCsFixer\Finder::create()
    ->in(__DIR__ . '/app')
    ->in(__DIR__ . '/config')
    ->in(__DIR__ . '/database')
    ->in(__DIR__ . '/routes')
    ->in(__DIR__ . '/tests');

return (new PhpCsFixer\Config())
    ->setRules([
        '@PSR12' => true,
        'array_syntax' => ['syntax' => 'short'],
        'ordered_imports' => ['sort_algorithm' => 'alpha'],
        'no_unused_imports' => true,
        'trailing_comma_in_multiline' => true,
        'single_quote' => true,
    ])
    ->setFinder($finder);
```

**Step 2: Run PHP CS Fixer in dry-run to verify config**

Run:
```bash
cd backend && vendor/bin/php-cs-fixer fix --dry-run --diff
```

Expected: Runs without config errors (may show files that need fixing)

---

## Task 5: Install Pest Testing Framework

**Files:**
- Modify: `backend/composer.json`
- Modify: `backend/tests/` directory

**Step 1: Install Pest and Laravel plugin**

Run:
```bash
cd backend && composer require --dev pestphp/pest pestphp/pest-plugin-laravel
```

Expected: Packages installed successfully

**Step 2: Initialize Pest**

Run:
```bash
cd backend && php artisan pest:install
```

Expected: Pest installed, test files converted to Pest syntax

**Step 3: Verify Pest installation**

Run:
```bash
cd backend && vendor/bin/pest --version
```

Expected: `Pest 2.x.x`

---

## Task 6: Run Initial Tests

**Files:** None

**Step 1: Run tests to verify everything works**

Run:
```bash
cd backend && php artisan test
```

Expected: All tests pass (default Laravel tests)

---

## Task 7: Add Composer Scripts

**Files:**
- Modify: `backend/composer.json`

**Step 1: Read current composer.json**

Read `backend/composer.json` to see existing scripts section.

**Step 2: Add custom scripts to composer.json**

Add to the `scripts` section in `backend/composer.json`:
```json
"scripts": {
    "analyse": "vendor/bin/phpstan analyse",
    "format": "vendor/bin/php-cs-fixer fix",
    "format:check": "vendor/bin/php-cs-fixer fix --dry-run --diff",
    "test": "php artisan test"
}
```

Note: Merge with existing scripts, don't replace the entire section.

**Step 3: Verify scripts work**

Run:
```bash
cd backend && composer analyse
```

Expected: PHPStan analysis runs

Run:
```bash
cd backend && composer format:check
```

Expected: PHP CS Fixer runs in check mode

Run:
```bash
cd backend && composer test
```

Expected: Tests run

---

## Task 8: Fix Any Code Style Issues

**Files:**
- Various PHP files in `backend/`

**Step 1: Run formatter to fix issues**

Run:
```bash
cd backend && composer format
```

Expected: Files fixed if any issues found

**Step 2: Verify no more issues**

Run:
```bash
cd backend && composer format:check
```

Expected: No files need fixing

---

## Task 9: Update .gitignore

**Files:**
- Modify: `backend/.gitignore`

**Step 1: Read current .gitignore**

Read `backend/.gitignore` to see current contents.

**Step 2: Add PHP CS Fixer cache to .gitignore**

Add to `backend/.gitignore` if not present:
```
/.php-cs-fixer.cache
```

---

## Task 10: Commit Development Tools Setup

**Files:**
- `backend/composer.json`
- `backend/composer.lock`
- `backend/phpstan.neon`
- `backend/.php-cs-fixer.php`
- `backend/.gitignore`
- `backend/tests/`

**Step 1: Check git status**

Run:
```bash
git status
```

**Step 2: Stage all changes**

Run:
```bash
git add backend/
```

**Step 3: Create commit**

Run:
```bash
git commit -m "$(cat <<'EOF'
chore: add development tools

- PHPStan level 5 with Larastan extension
- PHP CS Fixer with PSR-12 rules
- Pest testing framework
- Composer scripts for analyse, format, test
EOF
)"
```

**Step 4: Verify commit**

Run:
```bash
git log --oneline -1
```

Expected: Commit message "chore: add development tools"

---

## Phase 0.2 Completion Checklist

- [ ] PHPStan installed with Larastan
- [ ] phpstan.neon configured at level 5
- [ ] PHP CS Fixer installed
- [ ] .php-cs-fixer.php configured with PSR-12 rules
- [ ] Pest installed and initialized
- [ ] All default tests passing
- [ ] Composer scripts added (analyse, format, format:check, test)
- [ ] Code formatted with no style issues
- [ ] .gitignore updated
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 0.3: CI/CD Pipeline** for GitHub Actions workflow setup.
