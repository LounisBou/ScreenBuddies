# Phase 0.6: Laravel Telescope Setup

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Install Laravel Telescope for local debugging and request inspection.

**Architecture:** Telescope as dev-only dependency, accessible only in local environment.

**Tech Stack:** Laravel Telescope

**Prerequisites:**
- Phase 0.5 completed (Health check endpoint)

**Reference:** `docs/specifications/03-backend-architecture.md`

---

## Task 1: Install Telescope as Dev Dependency

**Files:**
- Modify: `backend/composer.json`

**Step 1: Install Telescope**

Run:
```bash
cd backend && composer require laravel/telescope --dev
```

Expected: Package installed successfully

**Step 2: Verify installation**

Run:
```bash
cd backend && composer show laravel/telescope
```

Expected: Package information displayed

---

## Task 2: Install Telescope Assets

**Files:**
- Create: Telescope migrations
- Create: Telescope config
- Create: Telescope service provider

**Step 1: Run Telescope install command**

Run:
```bash
cd backend && php artisan telescope:install
```

Expected: Telescope assets published

**Step 2: Run migrations for Telescope tables**

Run:
```bash
cd backend && php artisan migrate
```

Expected: Telescope tables created

**Step 3: Verify Telescope tables exist**

Run:
```bash
psql screenbuddies -c '\dt' | grep telescope
```

Expected: Telescope tables listed

---

## Task 3: Configure Telescope for Local Only

**Files:**
- Modify: `backend/app/Providers/TelescopeServiceProvider.php`

**Step 1: Read current TelescopeServiceProvider**

Read `backend/app/Providers/TelescopeServiceProvider.php` to see default configuration.

**Step 2: Update TelescopeServiceProvider**

Replace contents of `backend/app/Providers/TelescopeServiceProvider.php`:
```php
<?php

namespace App\Providers;

use Illuminate\Support\Facades\Gate;
use Laravel\Telescope\IncomingEntry;
use Laravel\Telescope\Telescope;
use Laravel\Telescope\TelescopeApplicationServiceProvider;

class TelescopeServiceProvider extends TelescopeApplicationServiceProvider
{
    public function register(): void
    {
        // Only load Telescope in local environment
        if ($this->app->environment('local')) {
            $this->app->register(\Laravel\Telescope\TelescopeServiceProvider::class);
        }

        Telescope::night();

        $this->hideSensitiveRequestDetails();

        Telescope::filter(function (IncomingEntry $entry) {
            if ($this->app->environment('local')) {
                return true;
            }

            return $entry->isReportableException() ||
                   $entry->isFailedRequest() ||
                   $entry->isFailedJob() ||
                   $entry->isScheduledTask() ||
                   $entry->hasMonitoredTag();
        });
    }

    protected function hideSensitiveRequestDetails(): void
    {
        Telescope::hideRequestParameters(['_token', 'password', 'password_confirmation']);
        Telescope::hideRequestHeaders(['cookie', 'x-csrf-token', 'x-xsrf-token', 'authorization']);
    }

    protected function gate(): void
    {
        Gate::define('viewTelescope', function ($user = null) {
            return $this->app->environment('local');
        });
    }
}
```

---

## Task 4: Test Telescope Installation

**Files:** None

**Step 1: Start server**

Run:
```bash
cd backend && php artisan serve &
```

**Step 2: Make a request to generate Telescope data**

Run:
```bash
curl -s http://localhost:8000/api/health
```

**Step 3: Open Telescope dashboard**

Open in browser: `http://localhost:8000/telescope`

Expected: Telescope dashboard loads, shows recent request

**Step 4: Stop server**

Run:
```bash
pkill -f "php artisan serve"
```

---

## Task 5: Verify Telescope Only Loads Locally

**Files:** None

**Step 1: Temporarily set APP_ENV to production**

Run:
```bash
cd backend && APP_ENV=production php artisan route:list | grep telescope
```

Expected: No Telescope routes listed (Telescope disabled in production)

---

## Task 6: Commit Telescope Setup

**Files:**
- `backend/composer.json`
- `backend/composer.lock`
- `backend/config/telescope.php`
- `backend/app/Providers/TelescopeServiceProvider.php`
- `backend/database/migrations/*telescope*`

**Step 1: Check git status**

Run:
```bash
git status
```

**Step 2: Stage Telescope files**

Run:
```bash
git add backend/
```

**Step 3: Create commit**

Run:
```bash
git commit -m "$(cat <<'EOF'
feat: add Laravel Telescope for local debugging

- Installed as dev dependency
- Only loads in local environment
- Sensitive data hidden (passwords, tokens)
- Night mode enabled by default
EOF
)"
```

**Step 4: Verify commit**

Run:
```bash
git log --oneline -1
```

Expected: Commit message "feat: add Laravel Telescope for local debugging"

---

## Phase 0.6 Completion Checklist

- [ ] Telescope installed as dev dependency
- [ ] Telescope assets installed
- [ ] Telescope migrations run
- [ ] TelescopeServiceProvider configured
- [ ] Local-only environment check added
- [ ] Sensitive data hiding configured
- [ ] Night mode enabled
- [ ] Gate restricts access to local
- [ ] Telescope dashboard tested
- [ ] Production mode verified (no Telescope)
- [ ] Git commit created

---

## Next Sub-Phase

Proceed to **Phase 0.7: Structured Logging** for JSON logging configuration.
